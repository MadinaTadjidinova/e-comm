<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cart Details</title>
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <link rel="icon" type="image/x-icon" href="images/logo-ecom1.png" />
  </head>
  <style>
    .cart-container {
      width: 80%;
      margin: auto;
    }

    .cart-item {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      margin-bottom: 20px;
      padding: 10px;
    }

    .cart-item img {
      width: 100px;
      height: 100px;
      object-fit: cover;
      margin-right: 20px;
    }

    .cart-item h4 {
      margin: 0;
      flex-grow: 1;
    }

    .cart-item p {
      margin: 0;
      font-weight: bold;
    }
    .popup-container {
      z-index: 1;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 500px;
      padding: 30px;
      background-color: #fff;
      border: 1px solid #ccc;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      border-radius: 15px;
      display: none;
    }

    .popup-container.show {
      display: block;
    }

    .popup-container label,
    .popup-container input,
    .popup-container button {
      display: block;
      margin-bottom: 20px;
    }

    .popup-container label {
      font-size: 18px;
      color: #333;
    }

    .popup-container input {
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
    }

    .popup-container button {
      background-color: #007bff;
      color: #fff;
      border: none;
      padding: 15px;
      cursor: pointer;
      font-size: 18px;
      border-radius: 5px;
    }

    .popup-container button:hover {
      background-color: #0056b3;
    }

    .card-details {
      border: 1px solid #ccc;
      padding: 20px;
      border-radius: 15px;
    }
    .hide {
      display: none;
    }
  </style>

  <body>
    <div class="container">
      <div class="navbar">
        <div class="logo">
          <a href="index.html">
            <img src="images/logo-ecom1.png" width="150px" />
          </a>
        </div>
        <div class="search_bar">
          <input type="text" name="search" placeholder="Поиск" />
          <button type="submit" class="search-button">
            <img src="images\icons8-search-24.png" />
          </button>
        </div>
        <nav>
          <ul id="MenuItems">
            <li><a href="index.html">Главная</a></li>
            <li><a href="allproducts.html">Продукты</a></li>
            <li><a href="about.html">О нас</a></li>
            <li><a href="contact.html">Контакт</a></li>
            <li id="user-menu-item"><a href="account.html">Аккаунт</a></li>
          </ul>
        </nav>
        <a href="cart.html">
          <img src="images/cart.png" width="30px" height="30px" />
        </a>
        <div class="toggle">
          <i class="fa-solid fa-moon toggle-icon"></i>
          <i class="fa-solid fa-sun toggle-icon"></i>
          <div class="toggle-ball"></div>
        </div>
        <img src="images/menu.png" class="menu-icon" onclick="menutoggle()" />
      </div>
    </div>
    <!-- --------------------cart item details--------->

    <div id="message1"></div>
    <div class="cart-container">
      <table id="table">
        <tr>
          <th>Продукт</th>
          <th>Количество</th>
          <th>Стоимость</th>
        </tr>
        <tbody></tbody>
      </table>
      <div class="total-price"></div>
      <button class="buy-btn">Купить</button>
      <div id="purchase-form" class="popup-container">
        <label for="address">Адрес:</label>
        <input type="text" id="address" required />

        <div class="card-details">
          <label for="card-number">Номер карты:</label>
          <input
            type="text"
            id="card-number"
            pattern="\d{4} \d{4} \d{4} \d{4}"
            placeholder="XXXX XXXX XXXX XXXX"
            required
          />

          <label for="expiry-date">Дата истечения срока действия:</label>
          <input
            type="text"
            id="expiry-date"
            pattern="\d{2}\/\d{2}"
            placeholder="MM/YY"
            required
          />

          <label for="cvv">CVV:</label>
          <input
            type="text"
            id="cvv"
            pattern="\d{3}"
            placeholder="XXX"
            required
          />
        </div>

        <label for="phone">Номер телефона:</label>
        <input type="text" id="phone" required />

        <button type="submit" class="thxToBuy">Оформить заказ</button>
      </div>
    </div>

    <!------footer--------->
    <div class="footer">
      <div class="container" data-aos="fade-up">
        <div class="row">
          <div class="footer-col-1">
            <h3>Принимаем к оплате</h3>

            <div class="app-logo">
              <img src="images/carta.webp" />
              <img src="images/logo-elcart.png" />
            </div>
          </div>
          <div class="footer-col-2">
            <img src="images/logo-ecom-white.png" />
            <p>
              Технология одна по себе не представляет интереса. Важно, что мы
              сможем сделать с помощью неё
            </p>
          </div>
          <div class="footer-col-3">
            <h3>Клиентам</h3>
            <ul>
              <li>Coupons</li>
              <li>Blog Post</li>
              <li>Return Policy</li>
              <li>Join Affiliate</li>
            </ul>
          </div>
          <div class="footer-col-4">
            <h3>Контактная информация</h3>
            <ul>
              <li>Facebook</li>
              <li>Twitter</li>
              <li>Instagram</li>
              <li>Youtube</li>
            </ul>
          </div>
        </div>
        <hr />
        <p class="copyright">
          Copyright &copy;
          <script type="text/javascript">
            document.write(new Date().getFullYear());
          </script>
          - Филин Николай Владимирович
        </p>
      </div>
    </div>

    <!-- --------------JS for toggle menu--------- -->
    <script>
      var MenuItems = document.getElementById("MenuItems");
      MenuItems.style.maxHeight = "0px";

      function menutoggle() {
        if (MenuItems.style.maxHeight == "0px") {
          MenuItems.style.maxHeight = "200px";
        } else {
          MenuItems.style.maxHeight = "0px";
        }
      }
    </script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
    <script>
      AOS.init();
    </script>
    <script>
      var cart = JSON.parse(localStorage.getItem("cart") || "[]");
      var tableBody = document.querySelector("#table tbody");

      function removeItem(index) {
        cart.splice(index, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        renderCartItems();
      }

      function renderCartItems() {
        var tableHeader = `
      <tr>
        <th>Продукт</th>
        <th>Количество</th>
        <th>Стоимость</th>
      </tr>
    `;

        var tableRows = cart
          .map(function (item, index) {
            return `
          <tr>
            <td class="product">
              <img src="${item.imageSrc}" alt="${item.title}" />
              <span>${item.title}</span>
              <button class="remove-btn" data-index="${index}">Удалить</button>
            </td>
            <td class="quantity">${item.quantity}</td>
            <td class="subtotal">${item.price * item.quantity}</td>
          </tr>
        `;
          })
          .join("");

        tableBody.innerHTML = tableHeader + tableRows;

        calculateTotalPrice();
        checkCartEmpty();
      }

      function calculateTotalPrice() {
        var total = cart.reduce(function (acc, item) {
          return acc + item.price * item.quantity;
        }, 0);

        var totalPriceElement = document.querySelector(".total-price");
        totalPriceElement.textContent = "Общая цена: " + total.toFixed(2) + "сом";
      }

      function checkCartEmpty() {
        var buyButton = document.querySelector(".buy-btn");
        buyButton.style.display = cart.length === 0 ? "none" : "block";
      }

      tableBody.addEventListener("click", function (event) {
        if (event.target.classList.contains("remove-btn")) {
          var index = parseInt(event.target.getAttribute("data-index"));
          removeItem(index);
        }
      });

      renderCartItems();

      document.addEventListener("DOMContentLoaded", function () {
        var buyButton = document.querySelector(".buy-btn");
        var purchaseForm = document.getElementById("purchase-form");
        var thxToBuyButton = document.querySelector(".thxToBuy");
        var message = document.getElementById("message1");
        var totalPrice = document.querySelector(".total-price");

        function checkCart() {
          var tableBody = document.querySelector("#table tbody");
          if (tableBody && tableBody.hasChildNodes()) {
            buyButton.disabled = false;
          } else {
            buyButton.disabled = true;
            buyButton.classList.add("hidden");
          }
        }

        checkCart();

        buyButton.addEventListener("click", function () {
          if (!buyButton.disabled) {
            purchaseForm.classList.add("show");
          }
        });

        thxToBuyButton.addEventListener("click", function (event) {
          event.preventDefault();

          var address = document.getElementById("address").value;
          var cardNumber = document.getElementById("card-number").value;
          var expiryDate = document.getElementById("expiry-date").value;
          var cvv = document.getElementById("cvv").value;
          var phone = document.getElementById("phone").value;

          // Perform purchase logic here, e.g., send data to the server

          tableBody.innerHTML = "";
          totalPrice.textContent = "0";

          message.textContent = "Спасибо за покупку!";
          message.classList.add("show");

          purchaseForm.classList.remove("show");
          thxToBuyButton.classList.add("hidden");

          setTimeout(function () {
            message.textContent = "";
            message.classList.remove("show");
            checkCart();
          }, 5000);
        });

        checkCart();
      });
    </script>

    <script src="./script.js"></script>
  </body>
</html>
